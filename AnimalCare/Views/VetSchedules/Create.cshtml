@model AnimalCare.Models.CreateVetScheduleViewModel

@{
    ViewData["Title"] = "Add Vet Schedule";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">
        <i class="bi bi-calendar-plus me-2 text-primary"></i> Add Veterinarian Schedule
    </h2>
</div>

<div class="alert alert-info shadow-sm mb-4">
    <i class="bi bi-info-circle me-2"></i>
    <strong>Schedule Rules:</strong>
    <ul class="mb-0 mt-2">
        <li>Each veterinarian must work <strong>at least 3 days per week</strong></li>
        <li>Working hours are fixed: <strong>8:00 AM to 4:00 PM</strong> (8 hours)</li>
        <li>Select the days the veterinarian will be available</li>
    </ul>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <form asp-action="Create" method="post">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                    <!-- Veterinarian Selection -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-person-badge"></i> Select Veterinarian
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label asp-for="VeterinarianId" class="form-label fw-semibold">Veterinarian</label>
                                <select asp-for="VeterinarianId" class="form-select" asp-items="ViewBag.VeterinarianId">
                                    <option value="">-- Select Veterinarian --</option>
                                </select>
                                <span asp-validation-for="VeterinarianId" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Working Days Selection -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-calendar-week"></i> Working Days (Select at least 3)
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">
                                <i class="bi bi-clock"></i> All selected days will have working hours: <strong>8:00 AM - 4:00 PM</strong>
                            </p>

                            <div class="row g-3">
                                @foreach (DayOfWeek day in Enum.GetValues(typeof(DayOfWeek)))
                                {
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   type="checkbox"
                                                   name="SelectedDays"
                                                   value="@((int)day)"
                                                   id="day@((int)day)">
                                            <label class="form-check-label" for="day@((int)day)">
                                                <strong>@day</strong>
                                                <span class="text-muted">(8:00 AM - 4:00 PM)</span>
                                            </label>
                                        </div>
                                    </div>
                                }
                            </div>

                            <span asp-validation-for="SelectedDays" class="text-danger d-block mt-2"></span>

                            <div class="alert alert-warning mt-3 mb-0">
                                <i class="bi bi-exclamation-triangle"></i>
                                <strong>Remember:</strong> You must select at least 3 days.
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Create Schedule
                        </button>
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Helper Card -->
    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <i class="bi bi-question-circle"></i> How It Works
            </div>
            <div class="card-body">
                <ol>
                    <li class="mb-2">Select a veterinarian from the dropdown</li>
                    <li class="mb-2">Check at least 3 days of the week</li>
                    <li class="mb-2">Click "Create Schedule"</li>
                    <li class="mb-0">The system will create the weekly schedule automatically</li>
                </ol>

                <hr>

                <h6 class="fw-bold">Example:</h6>
                <p class="mb-0">
                    If you select Monday, Wednesday, and Friday, the veterinarian will work:
                    <br>
                    <span class="badge bg-primary">Mon 8AM-4PM</span>
                    <span class="badge bg-primary">Wed 8AM-4PM</span>
                    <span class="badge bg-primary">Fri 8AM-4PM</span>
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Count selected days and show warning if less than 3
        document.addEventListener('DOMContentLoaded', function () {
            const checkboxes = document.querySelectorAll('input[name="SelectedDays"]');
            const form = document.querySelector('form');

            function updateDayCount() {
                const checkedCount = document.querySelectorAll('input[name="SelectedDays"]:checked').length;

                // You can add visual feedback here if needed
                if (checkedCount < 3) {
                    console.log(`Only ${checkedCount} days selected. Need at least 3.`);
                } else {
                    console.log(`${checkedCount} days selected. Good!`);
                }
            }

            checkboxes.forEach(cb => {
                cb.addEventListener('change', updateDayCount);
            });

            // Validate on submit
            form.addEventListener('submit', function(e) {
                const checkedCount = document.querySelectorAll('input[name="SelectedDays"]:checked').length;
                if (checkedCount < 3) {
                    e.preventDefault();
                    alert('Please select at least 3 working days.');
                    return false;
                }
            });
        });
    </script>
}
